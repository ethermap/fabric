<!DOCTYPE html>
<html lang="en">
    <head>
		<title>Fabric Example</title>
		<base href="" target="_blank">
        <meta charset="utf-8">
        <style>
            body{
            	background-color:#111133;
            	color:white;
            }
        </style>
    </head>

    <body> 
		<div>SRVX FABRIC RUNNER</div>
        <script type="module">
			
			import KeyCache from '/keycache/keycache.js';
			import fabric from './fabric.js';
			import * as util from './drivers/util.js'
			import { OriginMatrix } from '../frame/originmatrix.js'
			
			window.addEventListener( 'load' , async function(){
				
				// SIGNING CREDENTIALS PROVIDER
				var creds = new KeyCache();
				// await creds.loginAndLoad( 
				// 	[ ...String(window.location) ][37] , 
				// 	[ ...String(window.location) ][37] );

				var k = await creds.loginAndLoad( 'neo' , 'neo');				

				var ncr = creds.get('neo')
				var k = 3;

				//var f = 5
				//var h = 5
				//var v = await auth( { un:"yoiuo" , pw:"joij"} )
				//var d=3
 
				// fabric.mergeIntent( { 
				// 	    worker:'github.js',
				// 		driver:'github_esm',	
				// 		method:'smallList' } )			

				// fabric.mergeIntent( { 
				// 		driver:'github_esm',	
				// 		method:'smallList' } )			

				// fabric.mergeIntent( { 
				// 		driver:'github_esm',	
				//  		method:'smallList' } )			

				// fabric.mergeIntent( { 
				// 		driver:'github_esm',	
				// 		method:'smallList' } )	

				// fabric.mergeIntent( { 
				// 		driver:'extractor_esm', 
				// 		method:'rawMaps', 
				// 		uuid:'220x1c2c2cdd22', 
				// 		symbol:'SHIB'     } )		
				
				// fabric.mergeIntent( { 
				// 		brand:'ethereum', 
				// 		method:'pricedBalance', 
				// 		uuid:'0x1wwwwc2c2cdd22', 
				// 		symbol:'SHIB'     } )

				// fabric.mergeIntent( mergeArtifacts( { 
				// 	 brand:'coinbasepro'  , 
				// 	 method:'pricedBalances', 
				// 	 uuid:'0x1c2c2c22' 
				// } ) );				

				// fabric.mergeIntent( creds.mergeArtifacts( { 
				// 	driver:'extractor',
				// 	method:'rawMaps'
				// } ) ); 				

				var matrix = new OriginMatrix({});
				
			    fabric.addEventListener( 'fabricEvent' , async function( e ){
			        var data=e.detail;
					console.log('onFabricEvent: ',e.detail.method , '  UUID:', e.detail.uuid , '  payload:', e.detail.payload )
					console.log('|')					
			        var i=0;

					if( data.module == 'oai'){

						var payload = data.payload;
						
						matrix.incomingDiffFromOai( payload );
						
					}

					if( data.module == 'extractor'){

						// is there an array of objects to iterate and write to DB ? 
						var extr = 'wfe';
						for ( var  p in data.payload[0] ){

							var feature = data.payload[0][p];
							var l = feature;

						}
					}

					if( data.method =='login'){
						
						fabric.mergeIntent( { 
						 	uuid:'0x0x0x',
							module:'generic',
						 	method:'status'
						} ); 		
					}
					
			    }); // fabricEvent
				
				var reqObj1 = {
					module:'neo',
					method:'process',
					payload:{
						pattern:'(:Actor)--(:Movie)'
					}
				}
				var reqObj2 = {
					module:'neo',
					method:'process',
					params:{
						identifier:'4:f1731dc5-74ac-401d-9312-d6481729f6fb:1746' 
					}
				}				
				var reqObj3 = {
					module:'neo',
					method:'process',
					params:{
						object:{ 
							elementId:'4:f1731dc5-74ac-401d-9312-d6481729f6fb:1746' ,
							labels:['Blok'],
							properties:{
								domain:'omfp',
								width:'utaaa',
								color:'penk'
							}
						}
					}
				}		
				var reqObj4 = {
					module:'neo',
					method:'process',
					params:{
						link:{ 
							startElementId:'4:f1731dc5-74ac-401d-9312-d6481729f6fb:1746',
							endElementId:'4:f1731dc5-74ac-401d-9312-d6481729f6fb:33892',
							labels:['CONNECTS'],
							properties:{
								len:99,
								vou:'noin'
							}
						}
					}
				}
				var reqObj5 = {
					module:'neo',
					method:'process',
					params:{
						nodes:[
							{
								elementId:'4:f1731dc5-74ac-401d-9312-d6481729f6fb:1746' ,
								labels:['Blok'],
								properties:{
									domain:'omfp',
									width:'utaaa',
									color:'penk'
								}
							}
						],
						links:[
							{
								startElementId:'4:f1731dc5-74ac-401d-9312-d6481729f6fb:1746',
								endElementId:'4:f1731dc5-74ac-401d-9312-d6481729f6fb:33892',
								labels:['CONNECTS'],
								properties:{
									len:99
								}
							}
						]
					}
				}				
				var requestObject = { 
					brand:'neo',
					module:'neo',
					method:'query',
					pattern:'(:Actor)--(:Movie)',
					payload:{ uuid:'4:18de4a64-650a-4f3d-9657-0526a5183d76:955' ,  a:'rtr' , b:'f4f4' }
				}
				var requestObject = { 
					brand:'neo',
					module:'neo',
					method:'entry',
					elementId:'4:f1731dc5-74ac-401d-9312-d6481729f6fb:8746'
				}		
				var reqObj6 = {
					module:'neo',
					method:'process',
					params:{
						link:{ 
							startElementId:"4:f1731dc5-74ac-401d-9312-d6481729f6fb:33935",
							endElementId:"4:f1731dc5-74ac-401d-9312-d6481729f6fb:33934",
							type:'CONNECTS',
							properties:{
								weight:0,
								uuid:"795e1a9d-96d1-4d5a-8f99-9ef9b21dc243"
							}
						}
					}
				}					
				var reqObj_zp1 = {
					module:'neo',
					method:'process',
					params:{
						pattern:'(:Movie)--(:Person)'
					}
				}				
				var reqObj_zp = {
					module:'extractor',
					method:'features',
					params:{
						pattern:'(:Movie)--(:Person)'
					}
				}				
				var reqObj_chatg = {
					module:'oai',
					method:'query',
					uuid:'oaioai',
					params:{
						query1:'give me json list of top 10 corporations and include attributes name, marketcap as billions of dollars decimal, headquarters , annual revenue as billions of dollars decimal, add one attribute which is a list of names of corporations who supply each, by name',
						query2:'json list of top 50 corporations and include attributes name, marketcap as billions of dollars decimal, headquarters , annual revenue as billions of dollars decimal, add one attribute which is a list of names of corporations who supply each, by name',
						query:'return two arrays of json objects, one called "nodes" and the other called "links"  . In the nodes array return top 5 robotics corporations and in the links array return the relationships these companies have with eah other'
					}
				}							
				var reqObj_chatg = {
					module:'gdb',
					method:'query',
					uuid:'gdbgdb',
					params:{
						query1:'givr me json list of top 10 corporations and include attributes name, marketcap as billions of dollars decimal, headquarters , annual revenue as billions of dollars decimal, add one attribute which is a list of names of corporations who supply each, by name',
						query2:'json list of top 50 corporations and include attributes name, marketcap as billions of dollars decimal, headquarters , annual revenue as billions of dollars decimal, add one attribute which is a list of names of corporations who supply each, by name',
						query:'return two arrays of json objects, one called "nodes" and the other called "links"  . In the nodes array return top 5 robotics corporations and in the links array return the relationships these companies have with eah other'
					}
				}							
				
				
				reqObj_zp =  creds.mergeArtifacts( reqObj_chatg );
				
				fabric.mergeIntent( reqObj_chatg ); 				
				//await util.sleep(3000);

			
				
			});
		</script>













		
		
		<!-- Generated by the server -->
		<script id="datax" type="application/json">{"userId":1234,"userName":"John Doe","memberSince":"2000-01-01T00:00:00.000Z"}
		</script>
		<!-- Static -->
		<script>
		  const userInfo = JSON.parse( document.getElementById("datax").text );
		  //console.log("User information: %o", userInfo);
			
			    // DESIRED RETURNS: 
			    // Entity.domain new Adderss and priv-key
			    // Entity.domain existing-price-cluster
			    // Entity.domain.xclass / cluster  time-series 
			    //fabric.mergeIntent(  { domain:'crabauto', driver:'crabauto',                    fn:'fetchTicker' , uuid:'0x1c2c2c22'   } );
			    //fabric.mergeIntent(  { domain:'crabauto', driver:'crabauto',                    fn:'fetchTicker' , uuid:'0x1c2c2c22'   } );
			    //fabric.postMessage ? 
			
			    // whats better 
			    // workers[ driver ][ carrier ] = {} 
			    // workers[ uuid ] = {}
			
						    
			    //fabric.mergeIntent(  { driver:'ethers', domain:'ethereum',  fn:'init' , symbol:'ETH/USD' } );
			    //fabric.mergeIntent(  { driver:'ccxt', domain:'binanceus', fn:'init' , symbol:'BTC/USD' } );
			    //fabric.publishIntent(  { domain:['ccxt','coinbase','BTC/USD','init'] } );
			    //fabric.publishIntent(  { domain:'ccxt.coinbase.btc.close' } );
			    
			    //fabric.echoFunction(  { seek:nodeIDparamDomain[ domain, symbol ]( x,y,z*,s,t ) . demand:priceVector   })
			    //fabric.spawnRequest(  { domain:symbol:xclass } )
			
			    //fabric.publishIntent( { domain:'x', symbol:'XYZ', xclass:'priceTelemetryObject'  } );
			    //fabric.addEventListener( 'domain.event' , function( e ){ } )
			    
			    /*
			    fabric.addEventListener( 'message' , function( e ){    
			        var object_vector = e.data.domain + '.' +e.data.xclass;
			        isoModel.pushUpdate( object_vector , e.data.tick  );
			    });    */

				// 3 WAY RESOLUTION STYLE 
				// API.getRes( userIn )
				// 	.then( (obj) => {   } )
				// 	.catch( err => console.log )
				// 	.finally( () => console.log )
						        
			
				// var domain=data.domain;
			        // var symbol=data.symbol;
			        // var xclass=data.xclass;

				// loginAndLoad(  return_pair() )
				// loginAndLoad( hash_param_1 <<< *3, hash_param_2 >>> *3 )
				// loginAndLoad( hash_param_1 <<< *3, hash_param_2 >>> *3 )
				// SHould not pass creds ref ( keycache )
				// fabric.signer( creds ) 
				// fabric.singer( vault )			
				// await fabric.mergeIntent(  { dom:'binanceus' , carrier:'binanceus', driver:'ccxt',  method:'init' ,        uuid:'0x1c2c2c22'   } );
				// init / launch of each worker should happen automatically based on existence of intent: 
				// await fabric.mergeIntent( { brand:'ethereum' , uuid:'0x1c2c2c22' , symbol:'ETH/USDT'   } )
				// fabric.facilitate
				// fabric.support( )
				// fabric.mergeIntent( )
				// await fabric.mergeIntent( creds.mergeCredential( { 
				// await fabric.mergeIntent( { ...creds.keySelect( 'dom' )[0]  
				// 		driver:'github_esm',	
				// 		method:'smallList' } ) )
				// function  mergeCredentialsAndSpawn( obj ){
				//
				//   fabric.mergeIntent(   { ...creds.keySelect( 'dom' , obj.dom )[0] }  , ...obj ) 
				// }

			
		</script>

	</body>
	
</html>

