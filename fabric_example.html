<!DOCTYPE html>
<html lang="en">
    
    <head>
		<title>Fabric Example</title>
		<base href="" target="_blank">
        <meta charset="utf-8">
        <style>
            body{
            	background-color:#111133;
            	color:white;
            }
        </style>
    </head>

    <body> 
		<div>SRVX FABRIC RUNNER</div>
        <script type="module">
			import KeyCache from './../util/keycache.js';
			import fabric from './fabric.js';

			window.addEventListener( 'load' , async function(){
				
				// SIGNING CREDENTIALS PROVIDER
				var creds = new KeyCache();
				await creds.loginAndLoad('x','x');

				// WAIT
				// SHould not pass creds ref ( keycache )
				// to whole fabric? ( all creds don't need to be in )
				// workers ? 
				fabric.init( {creds:creds} )				
				// await fabric.mergeIntent(  { dom:'binanceus' , carrier:'binanceus', driver:'ccxt',  method:'init' ,        uuid:'0x1c2c2c22'   } );
				
				// init / launch of each worker should happen automatically based on existence of intent: 
				await fabric.mergeIntent( { brand:'binanceus' , uuid:'0x1c2c2c22' , method:'fetchTicker' , symbol:'ETH/USDT'   } );
				await fabric.mergeIntent( {                     uuid:'0x1c2c2c22' , method:'loadMarkets'     } );
				//await fabric.mergeIntent(  { method:'fetchBalance'     , uuid:'0x1c2c2c22' , symbol:'ETH/USD'   } );

			    fabric.addEventListener( 'fabricEvent' , function( e ){
			        
			        var data=e.detail;
					console.log('Fabric: ',e.detail.method)
			        var domain=data.domain;
			        var symbol=data.symbol;
			        var xclass=data.xclass; 
			        var i=0;
			    })						
			});
			
		</script>













		
		
		<!-- Generated by the server -->
		<script id="datax" type="application/json">{"userId":1234,"userName":"John Doe","memberSince":"2000-01-01T00:00:00.000Z"}
		</script>
		<!-- Static -->
		<script>
		  const userInfo = JSON.parse( document.getElementById("datax").text );
		  //console.log("User information: %o", userInfo);
			
			    // DESIRED RETURNS: 
			    // Entity.domain new Adderss and priv-key
			    // Entity.domain existing-price-cluster
			    // Entity.domain.xclass / cluster  time-series 
			    //fabric.mergeIntent(  { domain:'crabauto', driver:'crabauto',                    fn:'fetchTicker' , uuid:'0x1c2c2c22'   } );
			    //fabric.mergeIntent(  { domain:'crabauto', driver:'crabauto',                    fn:'fetchTicker' , uuid:'0x1c2c2c22'   } );
			    //fabric.postMessage ? 
			
			    // whats better 
			    // workers[ driver ][ carrier ] = {} 
			    // workers[ uuid ] = {}
			
						    
			    //fabric.mergeIntent(  { driver:'ethers', domain:'ethereum',  fn:'init' , symbol:'ETH/USD' } );
			    //fabric.mergeIntent(  { driver:'ccxt', domain:'binanceus', fn:'init' , symbol:'BTC/USD' } );
			    //fabric.publishIntent(  { domain:['ccxt','coinbase','BTC/USD','init'] } );
			    //fabric.publishIntent(  { domain:'ccxt.coinbase.btc.close' } );
			    
			    //fabric.echoFunction(  { seek:nodeIDparamDomain[ domain, symbol ]( x,y,z*,s,t ) . demand:priceVector   })
			    //fabric.spawnRequest(  { domain:symbol:xclass } )
			
			    //fabric.publishIntent( { domain:'x', symbol:'XYZ', xclass:'priceTelemetryObject'  } );
			    //fabric.addEventListener( 'domain.event' , function( e ){ } )
			    
			    /*
			    fabric.addEventListener( 'message' , function( e ){    
			        var object_vector = e.data.domain + '.' +e.data.xclass;
			        isoModel.pushUpdate( object_vector , e.data.tick  );
			    });    */
			
		</script>

	</body>
	
</html>

